function musicInWeixinHandler(){document.addEventListener("WeixinJSBridgeReady",function(){sound.load()},!1),document.removeEventListener("DOMContentLoaded",musicInWeixinHandler)}!function(){function e(){setTimeout(function(){E.append('<div><span class="text-bg date-time">2017年5月20日 10:50:41</span></div>'),setTimeout(function(){E.append('<div class="text-bg add-finish-tip">你已经添加了欧弟，现在可以聊天了</div>'),t()},800)},500)}function t(){$.get("json/msg_list.json",function(e){y=e.wordList,n()})}function n(){var e=Math.floor(1e3*Math.random())+2e3;h=setInterval(function(){if(y[w]){i(y[w]);var e=y[w].msg_reply_choice,t=y[w].msg_type;e?((I=y[w].msg_reply)&&I.length>0&&(L.empty(),b=c(I),L.append(b),3!=t&&setTimeout(function(){o()},2400)),clearInterval(h)):w++}else clearInterval(h)},e)}function i(e){E.css("height");var t=e.msg_from,n=e.msg_type,i="";1==t&&(3==n&&clearInterval(h),i=d(e)),E.append(i),setTimeout(function(){$(".friend-box").addClass("opacity-animate")},0),a(),setTimeout(function(){_.play()},100)}function o(){L.addClass("pop-up")}function a(){setTimeout(function(){p.refresh();var e=E.height(),t=u-v,n=e-t;e>t&&p.scrollTo(0,-n,300)},0)}function d(e){var t=e.msg_type,n='<div class="box friend-box"><img src="http://7xot92.com1.z0.glb.clouddn.com/oudi.jpg" alt="" class="box-avatar friend-avatar">';if(1==t)text=l(e.msg_content),n+='<div class="friend-text box-content">'+text+"</div></div>";else if(2==t){var i=-1==e.msg_img.indexOf("gif")?"img-redbag":"img-gif";n+='<div class="box-img "><img src="'+e.msg_img+'" alt="" class="friend-img '+i+'"></div></div>'}else n+='<div class="box-video" data-src="'+e.msg_video_src+'"><img src="'+e.msg_video_cover+'" alt="" class="video-cover"><img src="http://7xot92.com1.z0.glb.clouddn.com/play_btn.png" alt="" class="video-play-btn"></div></div>';return n}function s(e){return'<div class="box my-box"><img src="http://7xot92.com1.z0.glb.clouddn.com/avatar.jpg" alt="" class="box-avatar my-avatar"><div class="my-text box-content">'+(e=l(e))+"</div></div>"}function c(e){for(var t="",n=0,i=e.length;n<i;n++)t+=0==n?'<div data-id="'+n+'" class="btn active">'+l(e[n].msg_content)+"</div>":'<div data-id="'+n+'" class="btn ">'+l(e[n].msg_content)+"</div>";return t}function l(e){var t=/emoji(\d+)/g,n=t.exec(e);if(n&&n.length>0){var i='<i class="emoji" style="background-position:0 -'+r(n[1])+'rem"></i>';e=e.replace(t,i)}return e}function r(e){return 5==e?4.3:4==e?3.45:3==e?2.6:2==e?1.75:1==e?.9:0}var u,v,m,f,g,p,x,b,h,_=document.getElementById("sound"),y=[],I=[],T=[],E=$("#content"),L=$("#pop-box"),w=0;window.onload=function(){u=$(window).height(),v=$(".footer").height(),$("#main").height(u-v),e(),p=new IScroll("#main",{preventDefault:!1}),document.addEventListener("touchmove",function(e){e.preventDefault()},!1)},L[0].addEventListener("click",function(e){var t=e.target.getAttribute("data-id");if(null!=t){var o=s(I[t].msg_content);L.removeClass("pop-up"),E.append(o),a(),T=I[t].msg_reply,setTimeout(function(){i(T[0]),w++,n()},1e3)}},!0),$(".box-video").live("click",function(){var e=$(this).children().get(0),t=$(this).attr("data-src"),n=$(".full-box");null!=(x=document.getElementById("full_video"))?($fullVideo=$(".full-video"),$fullVideo.attr("src",t),$fullVideo.attr("poster",e.src)):(n.append('<video src="'+t+'" poster="'+e.src+'" controls preload="auto" class="full-video" id="full_video"></video>'),x=document.getElementById("full_video")),n.show(),x.play()}),$(".close").on("click",function(){$(".full-box").hide(),x.pause();var e=$(".full-video").attr("src");if(-1!=e.indexOf("video1")){if(m)return;setTimeout(function(){o()},100),m=!0}else if(-1!=e.indexOf("video2")){if(f)return;f=!0,n()}else{if(g)return;g=!0,n()}})}(),document.addEventListener("DOMContentLoaded",musicInWeixinHandler);